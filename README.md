# C²: Scalable Auto-Feedback for LLM-based Chart Generation

![](overview.png)

## Contents 
- [Project Site](#project-site)
- [Requirements](#requirements)
- [ChartAF](#chartaf)
- [ChartUIE-8K](#chartuie-8k)

## Project Site

Qualitative demonstration of the pre- and post-feedback of ChartAF is provided in [our project site](https://chartsquared.github.io/).

## Requirements

This project requires several Python packages to be installed. The dependencies are listed in the `requirements.txt` file. Follow the instructions below to set up the environment:

### Installation Instructions

1. **Clone the Repository**:

   ```bash
   git clone https://github.com/chartsquared/C2-ChartAF-and-ChartUIE8K.git
   cd C2-ChartAF-and-ChartUIE8K

2. **Install Dependencies**:

    Use pip to install the required packages listed in the requirements.txt file:

    ```bash
    pip install -r requirements.txt

3. **Updating Dependencies**:

    To update the dependencies in `requirements.txt`, you can manually add or modify the package versions. Alternatively, you can use the following command to generate an updated list based on your currently installed packages:

    ```bash
    pip freeze > requirements.txt
    ```

4. **API KEY**:

    You can choose to run LLMs on your own devices or use APIs. We use the following API providers: `OpenAI` for GPT-4o, `Anthropic` for Claude 3.5 Sonnet,`Groq` for Llama 3.1 70B, and `Deepinfra` for Gemma 2 27B. Set api keys of the API providers in first cell of the `main.ipynb` file.
    ```bash
    OPENAI_API_KEY = "<INSERT API KEY>"
    ANTHROPIC_API_KEY = "<INSERT API KEY>"
    GROQ_API_KEY = "<INSERT API KEY>"
    DEEPINFRA_API_KEY = "<INSERT API KEY>"
    ```



## ChartAF
The core logic for ChartAF resides in the `autofeedback.py`, while the overall workflow can be executed via `main.ipynb` file. The `feedbacks` directory stores the visual and code feedback generated by ChartAF, and the `plots_d2c` directory contains chart images both before and after feedback. These outputs are generated as part of the workflow, showcasing how feedback is processed and the corresponding charts are updated accordingly.

![ChartAF](chartaf.png)

### Module 1
- `prompts/AF_TPA.txt`
- `prompts/AF_criteria_establishment.txt`

### Module 2
- `prompts/AF_create_eval_q.txt`
- `prompts/AF_execute_eval.txt`.

### Module 3
- `prompts/AF_generate_feedback.txt`

## ChartUIE-8K

The ChartUIE-8K (Chart User Interaction Emulation) evaluation set can be found in the `ChartUIE_8K/UIE_evaluation_set` directory. Every file in the set follows the naming convention `uie_sample_{IDX}_{WORD_COUNT}_{SUB_IDX}.yaml`, where `IDX` refers to the sample index, `WORD_COUNT` indicates the number of words (either 50 or 100), and `SUB_IDX` is an additional index for multiple variations of each `IDX` sample. The underlying data sets corresponding to each query is located in the `ChartUIE_8K/data` directory. It includes .csv and .json files. The range of different chart types and topics used are mentioned in `chart_topics.yaml` and `chart_types.yaml` files. The license for each data is documented in `{IDX}_info.yaml` for each data index. This repository was made under non-profit academic use. Users of this repository should consider the license documented in `{IDX}_info.yaml`.
<!-- 
## ChartAgent

ChartAgent is responsible for handling data-to-chart (d2c) generation tasks. We utilized two closed-source models (GPT-4o and Claude 3.5 Sonnet) and two open-source models (Llama 3.1 70B and Gemma 2 27B). The code for ChartAgent is in `ChartAgent.py`.

ChartAgent performs two d2c tasks in the workflow. The first task is the initial d2c generation, where it creates chart code based on the user’s query (including initial instructions and further instructions in a Q&A format). The second task is the post-feedback d2c generation, which incorporates feedback from ChartAJ. -->
